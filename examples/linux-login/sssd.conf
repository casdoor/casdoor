# SSSD Configuration for Casdoor Authentication
# Copy this file to /etc/sssd/sssd.conf on your Linux client
# Remember to:
# 1. Replace CASDOOR_HOST with your Casdoor server hostname/IP
# 2. Replace YOUR_ORG_NAME with your Casdoor organization name
# 3. Set correct permissions: chmod 600 /etc/sssd/sssd.conf

[sssd]
config_file_version = 2
services = nss, pam, ssh
domains = casdoor

[domain/casdoor]
# Identity provider
id_provider = ldap
auth_provider = ldap
chpass_provider = ldap
access_provider = ldap

# Casdoor LDAP server connection
# For secure LDAPS (recommended for production):
ldap_uri = ldaps://CASDOOR_HOST:636
ldap_id_use_start_tls = False
ldap_tls_reqcert = demand
ldap_tls_cacert = /etc/pki/tls/certs/ca-bundle.crt

# For non-TLS LDAP (testing/development only - NOT for production):
# ldap_uri = ldap://CASDOOR_HOST:389

# Base DN for LDAP searches
# Replace YOUR_ORG_NAME with your actual organization name in Casdoor
ldap_search_base = ou=YOUR_ORG_NAME

# Authentication settings (optional - enable if anonymous bind is disabled)
# ldap_default_bind_dn = cn=admin,ou=YOUR_ORG_NAME
# ldap_default_authtok_type = password
# ldap_default_authtok = YOUR_BIND_PASSWORD

# User attribute mapping
ldap_user_object_class = posixAccount
ldap_user_name = uid
ldap_user_uid_number = uidNumber
ldap_user_gid_number = gidNumber
ldap_user_home_directory = homeDirectory
ldap_user_shell = loginShell
ldap_user_gecos = gecos
ldap_user_principal = uid

# SSH public key support
ldap_user_ssh_public_key = sshPublicKey

# Group attribute mapping
ldap_group_object_class = posixGroup
ldap_group_name = cn
ldap_group_gid_number = gidNumber
ldap_group_member = memberUid

# Access control - allow all authenticated POSIX users
ldap_access_order = filter
ldap_access_filter = (objectClass=posixAccount)

# To restrict to specific groups, use:
# ldap_access_filter = (memberOf=cn=ssh-users,ou=YOUR_ORG_NAME)

# Performance and caching
cache_credentials = true
entry_cache_timeout = 300
enumerate = false

# Offline authentication
offline_credentials_expiration = 2

[nss]
# Exclude system users from SSSD lookup
filter_users = root,bin,daemon,adm,lp,sync,shutdown,halt,mail,operator,nobody,systemd-network,dbus
filter_groups = root,bin,daemon,sys,adm,disk,lp,wheel

# Homedir override (optional)
# override_homedir = /home/%u

[pam]
offline_credentials_expiration = 2
pam_id_timeout = 5

[ssh]
# SSH public key retrieval
ssh_authorizedkeys_command = /usr/bin/sss_ssh_authorizedkeys
ssh_authorizedkeys_command_user = nobody
